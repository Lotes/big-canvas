<!DOCTYPE html>
<html>
<head>
    <title>big-canvas - <%= siteId %></title>
    <!-- jquery -->
    <script type="text/javascript" src="/jquery.min.js"></script>
    <!-- jquery layout -->
    <script type="text/javascript" src="/jquery.layout.min.js"></script>
    <link rel="stylesheet" href="/layout-default.css">
    <!-- jquery transit -->
    <script type="text/javascript" src="/jquery.transit.min.js"></script>
    <!-- knockback -->
    <script type="text/javascript" src="/knockback.min.js"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap-theme.min.css">
    <script type="text/javascript" src="/bootstrap.min.js"></script>
    <!-- big-canvas -->
    <script type="text/javascript">
        var siteId = "<%= siteId %>";
    </script>
    <script type="text/javascript" src="/big-canvas.js"></script>
    <link type="text/css" rel="stylesheet" href="/big-canvas.css"/>

    <script>
        function TransitionMachine(boxes, index) {
            var self = this;

            self.all = $(boxes);
            self.lastIndex = null;
            self.last = null;
            self.currentIndex = index;
            self.current = $(self.all[index]);

            self.all.addClass("hidden");
            self.current.removeClass("hidden");

            self.translate = function(index) {
                if(self.currentIndex == index)
                    return;
                var time = 400;
                var perspective = "600px";
                var next = $(self.all[index]);
                self.current
                    .css("z-index", 1000)
                    .transition({
                        perspective: perspective,
                        rotateY: "0deg"
                    }, 0)
                    .removeClass("hidden")
                    .transition({
                        perspective: perspective,
                        rotateY: "-180deg"
                    }, time);
                next
                    .css("z-index", 2000)
                    .transition({
                        perspective: perspective,
                        rotateY: "180deg"
                    }, 0)
                    .removeClass("hidden")
                    .transition({
                        perspective: perspective,
                        rotateY: "0deg"
                    }, time);
                if(self.last != null && index != self.lastIndex)
                    self.last.addClass("hidden");
                self.last = self.current;
                self.current = next;
                self.lastIndex = self.currentIndex;
                self.currentIndex = index;
            }
        }
        $(function() {
            var boxes = $(".comments-panel");
            var machine = new TransitionMachine(boxes, 0);
            var index = 0;
            $(".flip-button").click(function() {
                index = (index + 1) % boxes.length;
                //index = Math.floor(Math.random() * boxes.length);
                machine.translate(index);
            });

            var layout = $('body').layout({
                pane__spacing: 0,
                north__resizable: false,
                north__closable: false,
                south__resizable: false,
                south__closable: false,
                north__spacing_open: 0,
                south__spacing_open: 0,
                east__resizable: false,
                east__closable: true,
                east__spacing_open: 0,
                east__spacing_closed: 0,

                paneClass: "region",
                north__paneSelector: "#header-region",
                east__paneSelector: "#comments-region",
                center__paneSelector: "#canvas-region",
                south__paneSelector: "#tools-region",

                north__size: 50,
                south__size: 50,
                east__size: 381
            });
        });
    </script>
</head>
<body>
<div id="canvas-region" class="ui-layout-center">

</div>
<div id="header-region" class="ui-layout-north">
    <div id="logo">big-canvas</div>
</div>
<div id="tools-region" class="ui-layout-south">

</div>
<% include comments.ejs %>
</body>
</html>